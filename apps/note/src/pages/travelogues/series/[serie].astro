---
import { getCollection, type CollectionEntry } from 'astro:content'
import { Image } from 'astro:assets'
import Layout from '../../../layouts/Layout.astro'

export async function getStaticPaths() {
  const travelogues = await getCollection('travelogues')
  const series = [
    ...new Set(
      travelogues
        .filter((travelogue) => {
          return travelogue.data.serie
        })
        .map((travelogue) => {
          return travelogue.data.serie
        })
    )
  ]

  return series.map((serie) => {
    return { params: { serie: serie }, props: { travelogues } }
  })
}

const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/travelogues/**/*.{png,jpg}'
)

type Props = {
  travelogues: CollectionEntry<'travelogues'>[]
}
const { serie } = Astro.params
const { travelogues } = Astro.props
const serietravelogues = travelogues.filter((travelogue) => {
  return travelogue.data.serie === serie
})
---

<Layout>
  <h1>{serie}</h1>
  <ul>
    {
      serietravelogues.map((travelogue) => {
        const thumbnail = travelogue.data.thumbnail
          ? images[
              `/src/assets/travelogues/${travelogue.slug}/${travelogue.data.thumbnail}`
            ]
          : images[`/src/assets/travelogues/hanyou.jpg`]

        return (
          <li>
            <a href={`/travelogues/${travelogue.slug}`}>
              {travelogue.data.title}
            </a>
            <Image src={thumbnail()} alt="A bird." />
          </li>
        )
      })
    }
  </ul>
</Layout>
