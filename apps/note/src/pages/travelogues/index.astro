---
import { getCollection } from 'astro:content'
import { Image } from 'astro:assets'
import Layout from '../../layouts/Layout.astro'

const travelogues = await getCollection('travelogues')
const series = [
  ...new Set(
    travelogues
      .filter((travelogue) => {
        return travelogue.data.serie
      })
      .map((travelogue) => {
        return travelogue.data.serie
      })
  )
]
const images = import.meta.glob<{ default: ImageMetadata }>(
  '/src/assets/travelogues/**/*.{png,jpg}'
)
---

<Layout title="Welcome to Astro.">
  <main>
    <h1>travelogues</h1>
    <ul>
      {
        travelogues.map((travelogue) => {
          const thumbnail = travelogue.data.thumbnail
            ? images[
                `/src/assets/travelogues/${travelogue.slug}/${travelogue.data.thumbnail}`
              ]
            : images['/src/assets/travelogues/common.jpg']

          return (
            <li>
              <a href={`travelogues/${travelogue.slug}`}>
                {travelogue.data.title}
              </a>
              <Image src={thumbnail()} alt="A bird." />
            </li>
          )
        })
      }
    </ul>

    {
      series.length > 0 && (
        <>
          <h1>Series</h1>
          <ul>
            {series.map((serie) => {
              return (
                <li>
                  <a href={`/travelogues/series/${serie}`}>{serie}</a>
                </li>
              )
            })}
          </ul>
        </>
      )
    }
  </main>
</Layout>

<style></style>
