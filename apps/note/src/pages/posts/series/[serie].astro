---
import { type CollectionEntry } from 'astro:content'
import { Image } from 'astro:assets'
import Layout from '../../../layouts/Layout.astro'
import { getPostThumbnail } from '../../../shared/get-post-thumbnail'
import { PostsService } from '../../../services/posts/posts.service'

export async function getStaticPaths() {
  const service = await PostsService.init()
  const series = await service.getSeries()

  return series.map((serie) => {
    return { params: { serie }, props: { service } }
  })
}
type Props = {
  posts: CollectionEntry<'posts'>[]
  service: PostsService
}
const { serie } = Astro.params
const { service } = Astro.props
const seriePosts = await service.findBySeries([serie])
---

<Layout>
  <h1>{serie}</h1>
  <ul>
    {
      seriePosts.map((post) => {
        const thumbnail = getPostThumbnail(post.slug, post.data.genre, null)

        return (
          <li>
            <a href={`/posts/${post.slug}`}>{post.data.title}</a>
            <Image src={thumbnail()} alt="A bird." />
          </li>
        )
      })
    }
  </ul>
</Layout>
